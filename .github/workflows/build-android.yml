name: Build - Relay App
on:
  workflow_call:
    inputs:
      release:
        description: 'Whether to build a signed release APK, or merely perform a build without assembling an APK.'
        type: boolean
        default: false
      project:
        description: 'Name of the Gradle project to build.'
        type: string
        required: true
      app-certificate:
        description: 'TLS certificate that the app will use for mTLS with the server.'
        type: string
        required: true
      sentry-dsn:
        description: 'Sentry DSN.'
        type: string
        required: false
    secrets:
      app-private-key:
        description: 'Private key of a TLS certificate that the app will use for mTLS with the server.'
        required: true
      release-keystore:
        description: Base64-encoded keystore file.
        required: true
      release-store-key-alias:
        description: Alias of the key in the keystore.
        required: true
      release-store-key-password:
        description: Password of the key in the keystore.
        required: true
      release-store-password:
        description: Password of the keystore.
        required: true
      sentry-auth-token:
        description: Sentry authentication token.
        required: true
      api-key:
        description: API key that is used on the server.
        required: true

jobs:
  build-app:
    name: Android Build
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repository
        uses: actions/checkout@v4

      - name: Build the app
        uses: ./.github/actions/build-android
        with:
          server-certificate: ${{ vars.SERVER_CERTIFICATE_PEM }}
          project: ${{ inputs.project }}
          release: ${{ inputs.release }}
          app-private-key: ${{ inputs.app-private-key }}
          app-certificate: ${{ inputs.app-certificate }}
          sentry-dsn: ${{ inputs.sentry-dsn }}
          release-keystore: ${{ inputs.release-keystore }}
          release-store-key-alias: ${{ inputs.release-store-key-alias }}
          release-store-key-password: ${{ inputs.release-store-key-password }}
          release-store-password: ${{ inputs.release-store-password }}
          sentry-auth-token: ${{ inputs.sentry-auth-token }}
          api-key: ${{ inputs.api-key }}
